/*!
 * jQuery Upload File Plugin
 * version: 3.1.7
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */
(function(b){if(b.fn.ajaxForm==undefined){b.getScript("http://malsup.github.io/jquery.form.js")}var a={};a.fileapi=b("<input type='file'/>").get(0).files!==undefined;a.formdata=window.FormData!==undefined;b.fn.uploadFile=function(f){var n=b.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:true,dragDrop:true,autoSubmit:true,showCancel:true,showAbort:true,showDone:true,showDelete:false,showError:true,showStatusAfterSuccess:true,showStatusAfterError:true,showFileCounter:true,fileCounterStyle:"). ",showProgress:false,nestedForms:true,showDownload:false,onLoad:function(s){},onSelect:function(s){return true},onSubmit:function(s,v){},onSuccess:function(w,v,x,s){},onError:function(x,s,w,v){},onCancel:function(v,s){},downloadCallback:false,deleteCallback:false,afterUploadAll:false,uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:false,statusBarWidth:500,dragdropWidth:500,showPreview:true,previewHeight:"auto",previewWidth:"100%"},f);this.fileCounter=1;this.selectedFiles=0;this.fCounter=0;this.sCounter=0;this.tCounter=0;var e="ajax-file-upload-"+(new Date().getTime());this.formGroup=e;this.hide();this.errorLog=b("<div></div>");this.after(this.errorLog);this.responses=[];if(!a.formdata){n.dragDrop=false}if(!a.formdata){n.multiple=false}var m=this;var o=b("<div>"+b(this).html()+"</div>");b(o).addClass(n.uploadButtonClass);(function k(){if(b.fn.ajaxForm){if(n.dragDrop){var s=b('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>').width(n.dragdropWidth);b(m).before(s);b(s).append(o);b(s).append(b(n.dragDropStr));c(m,n,s)}else{b(m).before(o)}n.onLoad.call(this,m);i(m,e,n,o)}else{window.setTimeout(k,10)}})();this.startUpload=function(){b("."+this.formGroup).each(function(v,s){if(b(this).is("form")){b(this).submit()}})};this.getFileCount=function(){return m.selectedFiles};this.stopUpload=function(){b(".ajax-file-upload-abort").each(function(v,s){if(b(this).hasClass(m.formGroup)){b(this).click()}})};this.cancelAll=function(){b(".ajax-file-upload-cancel").each(function(v,s){if(b(this).hasClass(m.formGroup)){b(this).click()}})};this.update=function(s){n=b.extend(n,s)};this.createProgress=function(v){var s=new j(this,n);s.progressDiv.show();s.progressbar.width("100%");s.filename.html(m.fileCounter+n.fileCounterStyle+v);m.fileCounter++;m.selectedFiles++;if(n.showDownload){s.download.show();s.download.click(function(){if(n.downloadCallback){n.downloadCallback.call(m,[v])}})}s.del.show();s.del.click(function(){s.statusbar.hide().remove();var w=[v];if(n.deleteCallback){n.deleteCallback.call(this,w,s)}m.selectedFiles-=1;d(n,m)})};this.getResponses=function(){return this.responses};var l=false;function r(){if(n.afterUploadAll&&!l){l=true;(function s(){if(m.sCounter!=0&&(m.sCounter+m.fCounter==m.tCounter)){n.afterUploadAll(m);l=false}else{window.setTimeout(s,100)}})()}}function c(x,v,w){w.on("dragenter",function(s){s.stopPropagation();s.preventDefault();b(this).css("border","2px solid #A5A5C7")});w.on("dragover",function(s){s.stopPropagation();s.preventDefault()});w.on("drop",function(y){b(this).css("border","2px dotted #A5A5C7");y.preventDefault();x.errorLog.html("");var s=y.originalEvent.dataTransfer.files;if(!v.multiple&&s.length>1){if(v.showError){b("<div style='color:red;'>"+v.multiDragErrorStr+"</div>").appendTo(x.errorLog)}return}if(v.onSelect(s)==false){return}p(v,x,s)});b(document).on("dragenter",function(s){s.stopPropagation();s.preventDefault()});b(document).on("dragover",function(s){s.stopPropagation();s.preventDefault();w.css("border","2px dotted #A5A5C7")});b(document).on("drop",function(s){s.stopPropagation();s.preventDefault();w.css("border","2px dotted #A5A5C7")})}function q(s){var w="";var v=s/1024;if(parseInt(v)>1024){var x=v/1024;w=x.toFixed(2)+" MB"}else{w=v.toFixed(2)+" KB"}return w}function h(y){var z=[];if(jQuery.type(y)=="string"){z=y.split("&")}else{z=b.param(y).split("&")}var v=z.length;var s=[];var x,w;for(x=0;x<v;x++){z[x]=z[x].replace(/\+/g," ");w=z[x].split("=");s.push([decodeURIComponent(w[0]),decodeURIComponent(w[1])])}return s}function p(I,C,v){for(var D=0;D<v.length;D++){if(!g(C,I,v[D].name)){if(I.showError){b("<div style='color:red;'><b>"+v[D].name+"</b> "+I.extErrorStr+I.allowedTypes+"</div>").appendTo(C.errorLog)}continue}if(I.maxFileSize!=-1&&v[D].size>I.maxFileSize){if(I.showError){b("<div style='color:red;'><b>"+v[D].name+"</b> "+I.sizeErrorStr+q(I.maxFileSize)+"</div>").appendTo(C.errorLog)}continue}if(I.maxFileCount!=-1&&C.selectedFiles>=I.maxFileCount){if(I.showError){b("<div style='color:red;'><b>"+v[D].name+"</b> "+I.maxFileCountErrorStr+I.maxFileCount+"</div>").appendTo(C.errorLog)}continue}C.selectedFiles++;var E=I;var x=new FormData();var B=I.fileName.replace("[]","");x.append(B,v[D]);var z=I.formData;if(z){var G=h(z);for(var A=0;A<G.length;A++){if(G[A]){x.append(G[A][0],G[A][1])}}}E.fileData=x;var F=new j(C,I);var H="";if(I.showFileCounter){H=C.fileCounter+I.fileCounterStyle+v[D].name}else{H=v[D].name}F.filename.html(H);var w=b("<form style='display:block; position:absolute;left: 150px;' class='"+C.formGroup+"' method='"+I.method+"' action='"+I.url+"' enctype='"+I.enctype+"'></form>");w.appendTo("body");var y=[];y.push(v[D].name);u(w,E,F,y,C,v[D]);C.fileCounter++}}function g(x,w,z){var y=w.allowedTypes.toLowerCase().split(",");var v=z.split(".").pop().toLowerCase();if(w.allowedTypes!="*"&&jQuery.inArray(v,y)<0){return false}return true}function t(v,w){if(v){var s=new FileReader();s.onload=function(x){w.attr("src",x.target.result)};s.readAsDataURL(v)}}function d(v,x){if(v.showFileCounter){var w=b(".ajax-file-upload-filename").length;x.fileCounter=w+1;b(".ajax-file-upload-filename").each(function(B,z){var s=b(this).html().split(v.fileCounterStyle);var y=parseInt(s[0])-1;var A=w+v.fileCounterStyle+s[1];b(this).html(A);w--})}}function i(B,A,x,v){var C="ajax-upload-id-"+(new Date().getTime());var z=b("<form method='"+x.method+"' action='"+x.url+"' enctype='"+x.enctype+"'></form>");var w="<input type='file' id='"+C+"' name='"+x.fileName+"' accept='"+x.acceptFiles+"'/>";if(x.multiple){if(x.fileName.indexOf("[]")!=x.fileName.length-2){x.fileName+="[]"}w="<input type='file' id='"+C+"' name='"+x.fileName+"' accept='"+x.acceptFiles+"' multiple/>"}var y=b(w).appendTo(z);y.change(function(){B.errorLog.html("");var J=x.allowedTypes.toLowerCase().split(",");var F=[];if(this.files){for(G=0;G<this.files.length;G++){F.push(this.files[G].name)}if(x.onSelect(this.files)==false){return}}else{var H=b(this).val();var E=[];F.push(H);if(!g(B,x,H)){if(x.showError){b("<div style='color:red;'><b>"+H+"</b> "+x.extErrorStr+x.allowedTypes+"</div>").appendTo(B.errorLog)}return}E.push({name:H,size:"NA"});if(x.onSelect(E)==false){return}}d(x,B);v.unbind("click");z.hide();i(B,A,x,v);z.addClass(A);if(a.fileapi&&a.formdata){z.removeClass(A);var I=this.files;p(x,B,I)}else{var D="";for(var G=0;G<F.length;G++){if(x.showFileCounter){D+=B.fileCounter+x.fileCounterStyle+F[G]+"<br>"}else{D+=F[G]+"<br>"}B.fileCounter++}if(x.maxFileCount!=-1&&(B.selectedFiles+F.length)>x.maxFileCount){if(x.showError){b("<div style='color:red;'><b>"+D+"</b> "+x.maxFileCountErrorStr+x.maxFileCount+"</div>").appendTo(B.errorLog)}return}B.selectedFiles+=F.length;var s=new j(B,x);s.filename.html(D);u(z,x,s,F,B,null)}});if(x.nestedForms){z.css({margin:0,padding:0});v.css({position:"relative",overflow:"hidden",cursor:"default"});y.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"});z.appendTo(v)}else{z.appendTo(b("body"));z.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"});if(navigator.appVersion.indexOf("MSIE ")!=-1){v.attr("for",C)}else{v.click(function(){y.click()})}}}function j(w,v){this.statusbar=b("<div class='ajax-file-upload-statusbar'></div>").width(v.statusBarWidth);this.preview=b("<img class='ajax-file-upload-preview'></img>").width(v.previewWidth).height(v.previewHeight).appendTo(this.statusbar);this.filename=b("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar);this.progressDiv=b("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide();this.progressbar=b("<div class='ajax-file-upload-bar "+w.formGroup+"'></div>").appendTo(this.progressDiv);this.abort=b("<div class='ajax-file-upload-red ajax-file-upload-abort "+w.formGroup+"'>"+v.abortStr+"</div>").appendTo(this.statusbar).hide();this.cancel=b("<div class='ajax-file-upload-red ajax-file-upload-cancel "+w.formGroup+"'>"+v.cancelStr+"</div>").appendTo(this.statusbar).hide();this.done=b("<div class='ajax-file-upload-green'>"+v.doneStr+"</div>").appendTo(this.statusbar).hide();this.download=b("<div class='ajax-file-upload-green'>"+v.downloadStr+"</div>").appendTo(this.statusbar).hide();this.del=b("<div class='ajax-file-upload-red'>"+v.deletelStr+"</div>").appendTo(this.statusbar).hide();if(v.showQueueDiv){b("#"+v.showQueueDiv).append(this.statusbar)}else{w.errorLog.after(this.statusbar)}return this}function u(B,A,v,x,C,z){var y=null;var w={cache:false,contentType:false,processData:false,forceSync:false,type:A.method,data:A.formData,formData:A.fileData,dataType:A.returnType,beforeSubmit:function(H,E,G){if(A.onSubmit.call(this,x)!=false){var D=A.dynamicFormData();if(D){var s=h(D);if(s){for(var F=0;F<s.length;F++){if(s[F]){if(A.fileData!=undefined){G.formData.append(s[F][0],s[F][1])}else{G.data[s[F][0]]=s[F][1]}}}}}C.tCounter+=x.length;r();return true}v.statusbar.append("<div style='color:red;'>"+A.uploadErrorStr+"</div>");v.cancel.show();B.remove();v.cancel.click(function(){v.statusbar.remove();A.onCancel.call(C,x,v);C.selectedFiles-=x.length;d(A,C)});return false},beforeSend:function(D,s){v.progressDiv.show();v.cancel.hide();v.done.hide();if(A.showAbort){v.abort.show();v.abort.click(function(){D.abort();C.selectedFiles-=x.length})}if(!a.formdata){v.progressbar.width("5%")}else{v.progressbar.width("1%")}},uploadProgress:function(G,s,F,E){if(E>98){E=98}var D=E+"%";if(E>1){v.progressbar.width(D)}if(A.showProgress){v.progressbar.html(D);v.progressbar.css("text-align","center")}},success:function(D,s,F){if(A.returnType=="json"&&b.type(D)=="object"&&D.hasOwnProperty(A.customErrorKeyStr)){v.abort.hide();var E=D[A.customErrorKeyStr];A.onError.call(this,x,200,E,v);if(A.showStatusAfterError){v.progressDiv.hide();v.statusbar.append("<span style='color:red;'>ERROR: "+E+"</span>")}else{v.statusbar.hide();v.statusbar.remove()}C.selectedFiles-=x.length;B.remove();C.fCounter+=x.length;return}C.responses.push(D);v.progressbar.width("100%");if(A.showProgress){v.progressbar.html("100%");v.progressbar.css("text-align","center")}v.abort.hide();A.onSuccess.call(this,x,D,F,v);if(A.showStatusAfterSuccess){if(A.showDone){v.done.show();v.done.click(function(){v.statusbar.hide("slow");v.statusbar.remove()})}else{v.done.hide()}if(A.showDelete){v.del.show();v.del.click(function(){v.statusbar.hide().remove();if(A.deleteCallback){A.deleteCallback.call(this,D,v)}C.selectedFiles-=x.length;d(A,C)})}else{v.del.hide()}}else{v.statusbar.hide("slow");v.statusbar.remove()}if(A.showDownload){v.download.show();v.download.click(function(){if(A.downloadCallback){A.downloadCallback(D)}})}B.remove();C.sCounter+=x.length},error:function(E,s,D){v.abort.hide();if(E.statusText=="abort"){v.statusbar.hide("slow").remove();d(A,C)}else{A.onError.call(this,x,s,D,v);if(A.showStatusAfterError){v.progressDiv.hide();v.statusbar.append("<span style='color:red;'>ERROR: "+D+"</span>")}else{v.statusbar.hide();v.statusbar.remove()}C.selectedFiles-=x.length}B.remove();C.fCounter+=x.length}};if(A.showPreview&&z!=null){if(z.type.toLowerCase().split("/").shift()=="image"){t(z,v.preview)}}if(A.autoSubmit){B.ajaxSubmit(w)}else{if(A.showCancel){v.cancel.show();v.cancel.click(function(){B.remove();v.statusbar.remove();A.onCancel.call(C,x,v);C.selectedFiles-=x.length;d(A,C)})}B.ajaxForm(w)}}return this}}(jQuery));